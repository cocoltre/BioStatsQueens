---
title: "Predicting Mortgage Yield using Regression Analysis"
author: "Your Name(s)"
date: "`r Sys.Date()`"
output: pdf_document
geometry: margin=2.5cm
fontsize: 12pt
header-includes:
  - \usepackage{graphicx}
  - \usepackage{amsmath}
  - \usepackage{booktabs}
  - \usepackage{caption}
editor_options: 
  markdown: 
    wrap: 72
---

# Introduction

Mortgage Yield (`mortYld`) is predicted based on economic and demographic factors.  
This report investigates the relationship between mortgage yield and six predictor variables:

- **X1:** Loan-to-Mortgage Ratio (high values indicate low down payments)
- **X2:** Distance from Boston (miles)
- **X3:** Savings per new unit built
- **X4:** Savings per capita
- **X5:** Population increase (1950-1960, %)
- **X6:** First mortgage from inter-regional banks (%)

---

# Exploratory Data Analysis (EDA)

## Load Data and Libraries

```{r}
# Load necessary libraries
library(ggplot2)
library(dplyr)
library(knitr)
library(kableExtra)
library(xtable)
library(MASS)
library(car)  # For VIF (multicollinearity check)

# Read dataset
df <- read.csv("myield.csv")

# Rename columns for easier reference
colnames(df) <- c("mortYld", "X1", "X2", "X3", "X4", "X5", "X6")

# Display first few rows
kable(head(df), caption = "First few rows of the dataset") %>% kable_styling()
```

```{r}
# Summary Statistics
summary_stats <- summary(df)
kable(summary_stats, caption = "Summary Statistics of Variables") %>% kable_styling()
```

```{r}
# Correlation Matrix
cor_matrix <- round(cor(df), 2)
kable(cor_matrix, caption = "Correlation Matrix") %>% kable_styling()
```

```{r}
# Histogram of Mortgage Yield
ggplot(df, aes(x = mortYld)) + 
  geom_histogram(binwidth = 0.2, fill = "blue", alpha = 0.6) +
  labs(title = "Distribution of Mortgage Yield", x = "Mortgage Yield (%)", y = "Count")

# Scatter Plot: Mortgage Yield vs Loan/Mortgage Ratio
ggplot(df, aes(x = X1, y = mortYld)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "red") +
  labs(title = "Mortgage Yield vs Loan/Mortgage Ratio", 
       x = "Loan/Mortgage Ratio", y = "Mortgage Yield (%)")

```

```{r}
# Fit linear regression model
model <- lm(mortYld ~ X1 + X2 + X3 + X4 + X5 + X6, data = df)

# Model summary
summary(model)

# Stepwise regression
step_model <- stepAIC(model, direction = "both")
summary(step_model)
```

```{r}
# Compute Variance Inflation Factor (VIF)
vif_values <- vif(model)
kable(as.data.frame(vif_values), caption = "Variance Inflation Factors (VIF)") %>% kable_styling()
```

```{r}
# Residuals vs Fitted Plot
ggplot(data.frame(fitted = fitted(model), residuals = resid(model)), aes(x = fitted, y = residuals)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(title = "Residuals vs Fitted Plot", x = "Fitted Values", y = "Residuals")
```


```{r}
# QQ-Plot of Residuals
ggplot(data.frame(sample = qqnorm(resid(model), plot.it = FALSE)$x, theoretical = qqline(resid(model), plot.it = FALSE)), 
       aes(sample, theoretical)) +
  geom_point() +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
  labs(title = "QQ-Plot of Residuals", x = "Theoretical Quantiles", y = "Sample Quantiles")
```

```{r}
coeffs <- round(coef(model), 2)
kable(as.data.frame(coeffs), caption = "Final Model Coefficients") %>% kable_styling()

```
